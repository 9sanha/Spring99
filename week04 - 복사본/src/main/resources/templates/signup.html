<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <meta charset="UTF-8">
<!--    <script type="application/js" src="../signup.js"></script>-->
    <title>회원가입 페이지</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        console.log("여기까지 오긴 하니1") // 옴

        function onclickAdmin() {
            console.log("여기까지 오긴 하니2")
// Get the checkbox
            let checkBox = document.getElementById("admin-check");
// Get the output text
            let box = document.getElementById("admin-token");

// If the checkbox is checked, display the output text
            if (checkBox.checked === true){
                box.style.display = "block";
            } else {
                box.style.display = "none";
            }
        }


        function check(){
            console.log("여기까지 오긴 하니3")// dha
            let id = document.getElementsByName('username').values();
            let password = document.getElementsByName('password').values;
            let passwordCheck = document.getElementsByName('passwordCheck').values;
            let isSame = password===passwordCheck;
            if (!isSame){
                alert("비밀번호가 일치하지 않습니다.")
                document.signup.passwordCheck.focus();
                isPwOk=false;
                return;
            }



            if (checkId(id)&&checkPw(password,passwordCheck,id)){
                console.log("여기까지는 오니.,?")
                document.signup.action="/user/signup"
                document.signup.submit()
                alert("회원가입이 완료되었습니다.")
            }

        }

        function checkId(id) { // 검사 통과하면 true값 반환

            let idReg = /^[a-zA-Z0-9]{3,}$/;
            let isNewId=true;
            if (idReg.test(id)) {
                alert("아이디의 형식이 맞지 않습니다 (3자 이상, 알파벳 대,소문자, 숫자 가능)")
                isNewId=false;
            } else if (id.length < 3) {
                alert("아이디 최소 길이는 3 입니다.")
                isNewId=false;
            }

            $.ajax({
                type: "GET",
                url: '/user/checkId/{username}',
                success: function (response) {
                    if (!response) {// 아이디가 중복될 때
                        console.log("여기까지 오긴 하니")//옴
                        alert("중복된 아이디입니다.")
                        isNewId=false;
                    }
                }
            })
            console.log("여기까지 오긴 하sssss니")//옴
            if (!isNewId){
                document.signup.password.focus();
            }
            return isNewId;
        }

        function checkPw(password,id){
            console.log("여기까지 오긴 하니")
            let isPwOk = true;
            let pwReg = /^[a-zA-Z0-9]{4,}$/;
            if (pwReg.test(password)) {
                alert("비밀번호의 형식이 맞지 않습니다 (4자 이상, 알파벳 대,소문자, 숫자 가능)")
                document.signup.password.focus();
                isPwOk=false;
            }else if (!password.search(id)){
                console.log(password.search(id)," id = ",id)
                alert("비밀번호는 아이디를 포함할 수 없습니다")
                document.signup.password.focus();
                isPwOk=false;
            }
            return isPwOk;
        }

    </script>
</head>
<body>
<div id="login-form">
    <div id="login-title">Sign up Select Shop</div>

    <form name="signup"  method="post" onsubmit="return check()">
        <div class="login-id-label">Username</div>
        <input type="text" name="username" placeholder="Username" class="login-input-box">

        <div class="login-id-label">Password</div>
        <input type="password" name="password" class="login-input-box">

        <div class="login-id-label">Password check</div>
        <input type="password" name="passwordCheck" placeholder="passwordCheck" class="login-input-box">

        <div class="login-id-label">E-mail</div>
        <input type="text" name="email" placeholder="E-mail" class="login-input-box">

        <div>
            <input id="admin-check" type="checkbox" name="admin" onclick="onclickAdmin()" style="margin-top: 40px;">관리자
            <input id="admin-token" type="password" name="adminToken" placeholder="관리자 암호" class="login-input-box" style="display:none">
        </div>
        <button id="login-id-submit">회원 가입</button>

    </form>
</div>
</body>
</html>